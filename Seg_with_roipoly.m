%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Segmentation with roipoly
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%[BW_1_sys,x1s,y1s] = roipoly(img1_sys_bin);
x1s = [49.0354691075515 50.1910755148742 51.8089244851259 54.1201372997712 57.8180778032037 61.0537757437071 64.2894736842106 67.7562929061785 73.0720823798627 76.3077803203662 80.2368421052632 83.7036613272312 86.0148741418765 87.4016018306636 89.0194508009154 89.7128146453090 90.1750572082380 89.4816933638444 88.0949656750572 86.0148741418765 84.3970251716248 81.6235697940504 79.7745995423341 75.8455377574371 72.3787185354692 69.1430205949657 65.9073226544623 61.5160183066362 58.2803203661328 54.8135011441648 53.1956521739131 52.0400457665904 50.6533180778033 49.0354691075515];
y1s = [59.3203661327231 54.0045766590389 50.7688787185355 48.4576659038901 46.3775743707094 45.2219679633867 44.0663615560641 43.3729977116705 42.2173913043478 42.2173913043478 42.6796338672769 43.3729977116705 45.2219679633867 48.6887871853547 51.2311212814645 54.0045766590389 57.2402745995423 60.9382151029748 64.6361556064073 67.6407322654462 69.4897025171625 71.3386727688787 72.4942791762014 73.6498855835240 73.6498855835240 73.8810068649886 73.8810068649886 72.7254004576659 71.3386727688787 69.2585812356979 67.4096109839817 64.8672768878719 62.5560640732265 59.3203661327231];
BW_1_sys = roipoly(img1_sys_bin,x1s,y1s);

%[BW_2_sys,x2s,y2s] = roipoly(img2_sys_bin);
x2s = [51.3466819221968 52.0400457665904 53.6578947368421 56.8935926773456 59.4359267734554 61.2848970251717 64.5205949656751 68.9118993135012 71.9164759725401 75.1521739130435 78.6189931350115 81.8546910755149 85.0903890160184 87.1704805491991 88.7883295194509 89.9439359267735 89.7128146453090 89.0194508009154 87.1704805491991 84.3970251716248 82.0858123569794 79.3123569794051 76.3077803203662 72.8409610983982 70.5297482837529 67.5251716247140 62.9027459954234 59.2048054919909 55.7379862700229 53.1956521739131 52.0400457665904 51.5778032036614 51.3466819221968];
y2s = [58.8581235697940 53.0800915331808 50.5377574370709 48.4576659038901 47.0709382151030 45.6842105263158 44.2974828375286 43.1418764302059 43.1418764302059 43.1418764302059 43.3729977116705 44.2974828375286 46.3775743707094 49.3821510297483 52.1556064073227 55.8535469107551 58.3958810068650 62.0938215102975 65.3295194508009 68.1029748283753 69.2585812356979 70.4141876430206 71.5697940503433 73.4187643020595 74.3432494279176 75.0366132723112 75.7299771167048 74.8054919908467 72.0320366132723 67.8718535469107 64.1739130434783 61.8627002288330 58.8581235697940];
BW_2_sys = roipoly(img2_sys_bin,x2s,y2s);

%[BW_3_sys,x3s,y3s] = roipoly(img3_sys_bin);
x3s = [50.8844393592678 52.5022883295195 55.0446224256293 58.2803203661328 61.5160183066362 66.3695652173913 70.2986270022884 74.2276887871854 78.3878718535470 81.6235697940504 84.6281464530893 86.9393592677346 88.0949656750572 88.5572082379863 88.3260869565218 86.7082379862701 83.9347826086957 79.7745995423341 77.0011441647598 72.8409610983982 67.9874141876431 63.3649885583524 58.7425629290618 55.0446224256293 53.1956521739131 51.8089244851259 50.8844393592678 50.8844393592678];
y3s = [54.2356979405034 49.3821510297483 46.3775743707094 43.1418764302059 41.2929061784897 40.3684210526316 40.1372997711670 40.1372997711670 41.5240274599542 43.1418764302059 44.9908466819222 48.4576659038901 52.3867276887872 56.7780320366133 60.0137299771167 64.4050343249428 68.1029748283753 70.4141876430206 72.2631578947368 74.3432494279176 74.5743707093821 74.8054919908467 73.1876430205950 70.8764302059497 67.4096109839817 63.0183066361556 59.3203661327231 54.2356979405034];
BW_3_sys = roipoly(img3_sys_bin,x3s,y3s);

%[BW_4_sys,x4s,y4s] = roipoly(img4_sys_bin);
x4s = [50.4221967963387 50.8844393592678 52.2711670480550 55.2757437070938 58.7425629290618 63.8272311212815 67.5251716247140 71.4542334096110 75.1521739130435 78.8501144164760 82.5480549199085 84.3970251716248 85.5526315789474 85.7837528604119 85.3215102974829 82.3169336384440 78.6189931350115 74.4588100686499 69.3741418764302 65.2139588100687 60.5915331807781 55.9691075514874 52.7334096109840 51.5778032036614 50.4221967963387];
y4s = [56.0846681922197 51.2311212814645 46.8398169336384 44.2974828375286 41.0617848970252 39.9061784897025 39.4439359267735 39.6750572082380 40.3684210526316 43.1418764302059 45.6842105263158 49.3821510297483 53.7734553775744 57.9336384439359 62.3249427917620 66.0228832951945 69.4897025171625 71.5697940503433 72.4942791762014 73.4187643020595 72.7254004576659 70.6453089244851 65.7917620137300 61.8627002288330 56.0846681922197];
BW_4_sys = roipoly(img4_sys_bin,x4s,y4s);

%[BW_5_sys,x5s,y5s] = roipoly(img5_sys_bin);
x5s = [49.4977116704806 49.2665903890160 51.1155606407323 53.4267734553776 56.4313501144165 61.2848970251717 66.1384439359268 72.6098398169337 77.6945080091534 81.3924485125858 82.3169336384440 83.4725400457666 83.0102974828376 80.6990846681923 77.4633867276888 73.9965675057209 69.1430205949657 63.3649885583524 58.7425629290618 54.1201372997712 51.1155606407323 49.4977116704806 49.4977116704806];
y5s = [54.0045766590389 49.6132723112128 45.2219679633867 41.7551487414188 40.1372997711670 39.2128146453089 39.2128146453089 39.6750572082380 42.9107551487414 46.3775743707094 50.0755148741419 54.6979405034325 59.3203661327231 62.5560640732265 66.0228832951945 68.1029748283753 69.4897025171625 70.6453089244851 70.1830663615561 66.4851258581236 63.4805491990847 59.7826086956522 54.0045766590389];
BW_5_sys = roipoly(img5_sys_bin,x5s,y5s);

%[BW_1_dias,x1d,y1d] = roipoly(img1_dias_bin);
x1d = [54.5823798627003 53.4267734553776 53.8890160183067 56.4313501144165 60.3604118993135 64.0583524027460 68.4496567505721 72.3787185354692 75.8455377574371 77.0011441647598 75.8455377574371 73.5343249427918 70.7608695652174 66.3695652173913 61.0537757437071 56.6624713958810 54.5823798627003];
y1d = [63.9427917620137 60.4759725400458 55.6224256292906 52.8489702517162 51.6933638443936 51.4622425629291 51.9244851258581 53.5423340961098 56.3157894736842 60.4759725400458 64.6361556064073 67.6407322654462 69.7208237986270 71.1075514874142 69.7208237986270 67.8718535469107 63.9427917620137];
BW_1_dias = roipoly(img1_dias_bin,x1d,y1d);

%[BW_2_dias,x2d,y2d] = roipoly(img2_dias_bin);
x2d = [55.0446224256293 55.9691075514874 59.4359267734554 63.3649885583524 67.5251716247140 71.4542334096110 73.9965675057209 76.0766590389016 76.5389016018307 75.1521739130435 71.4542334096110 68.2185354691076 64.7517162471396 58.9736842105264 55.5068649885584 55.0446224256293];
y2d = [59.0892448512586 54.4668192219680 51.9244851258581 50.7688787185355 50.7688787185355 51.4622425629291 53.0800915331808 55.6224256292906 59.3203661327231 63.7116704805492 65.7917620137300 66.9473684210526 67.1784897025172 66.4851258581236 63.0183066361556 59.0892448512586];
BW_2_dias = roipoly(img2_dias_bin,x2d,y2d);

%[BW_3_dias,x3d,y3d] = roipoly(img3_dias_bin);
x3d = [54.8135011441648 56.4313501144165 59.2048054919909 63.1338672768879 67.2940503432495 71.2231121281465 74.4588100686499 75.1521739130435 75.8455377574371 74.2276887871854 70.9919908466819 67.5251716247140 62.6716247139588 58.0491990846682 55.2757437070938 54.8135011441648 54.8135011441648];
y3d = [55.8535469107551 52.8489702517162 51.0000000000000 50.0755148741419 49.8443935926773 50.7688787185355 52.8489702517162 56.0846681922197 59.7826086956522 63.4805491990847 65.5606407322654 66.4851258581236 67.1784897025172 65.7917620137300 62.3249427917620 59.3203661327231 55.8535469107551];
BW_3_dias = roipoly(img3_dias_bin,x3d,y3d);

%[BW_4_dias,x4d,y4d] = roipoly(img4_dias_bin);
x4d = [53.8890160183067 54.8135011441648 57.3558352402746 62.2093821510298 66.1384439359268 68.6807780320366 70.7608695652174 70.2986270022884 67.5251716247140 63.5961098398170 58.9736842105264 55.9691075514874 53.8890160183067];
y4d = [55.6224256292906 51.6933638443936 49.8443935926773 49.1510297482838 50.0755148741419 52.1556064073227 55.3913043478261 58.6270022883295 61.8627002288330 63.7116704805492 63.2494279176201 60.7070938215103 55.6224256292906];
BW_4_dias = roipoly(img4_dias_bin,x4d,y4d);

%[BW_5_dias,x5d,y5d] = roipoly(img5_dias_bin);
x5d = [51.8089244851259 53.1956521739131 56.4313501144165 60.8226544622426 64.9828375286042 67.7562929061785 69.8363844393593 70.5297482837529 70.2986270022884 68.4496567505721 65.2139588100687 61.5160183066362 57.8180778032037 53.6578947368421 52.0400457665904 51.8089244851259];
y5d = [55.8535469107551 51.4622425629291 49.3821510297483 48.6887871853547 49.3821510297483 50.7688787185355 52.8489702517162 55.1601830663616 58.6270022883295 61.6315789473684 63.9427917620137 64.6361556064073 64.6361556064073 62.5560640732265 59.5514874141876 55.8535469107551];
BW_5_dias = roipoly(img5_dias_bin,x5d,y5d);

%% 
originalSize = [256 256]; % tamaño original DICOM

idx1 = 70;
idx2 = 170;

roipoly1_sys = PadToOriginal(BW_1_sys,  idx1, idx2, originalSize);
roipoly2_sys  = PadToOriginal(BW_2_sys,  idx1, idx2, originalSize);
roipoly3_sys  = PadToOriginal(BW_3_sys,  idx1, idx2, originalSize);
roipoly4_sys  = PadToOriginal(BW_4_sys,  idx1, idx2, originalSize);
roipoly5_sys  = PadToOriginal(BW_5_sys,  idx1, idx2, originalSize);
 
roipoly1_dias = PadToOriginal(BW_1_dias, idx1, idx2, originalSize);
roipoly2_dias = PadToOriginal(BW_2_dias, idx1, idx2, originalSize);
roipoly3_dias = PadToOriginal(BW_3_dias, idx1, idx2, originalSize);
roipoly4_dias = PadToOriginal(BW_4_dias, idx1, idx2, originalSize);
roipoly5_dias = PadToOriginal(BW_5_dias, idx1, idx2, originalSize);

figure;
subplot(2,5,1);
imagesc(roipoly1_sys); colormap('gray'); title('Vol Img1Sys Estimé');

subplot(2,5,2);
imagesc(roipoly2_sys); colormap('gray'); title('Vol Img2Sys Estimé');

subplot(2,5,3);
imagesc(roipoly3_sys); colormap('gray'); title('Vol Img3Sys Estimé');

subplot(2,5,4);
imagesc(roipoly4_sys); colormap('gray'); title('Vol Img4Sys Estimé');

subplot(2,5,5);
imagesc(roipoly5_sys); colormap('gray'); title('Vol Img5Sys Estimé');

subplot(2,5,6);
imagesc(roipoly1_dias); colormap('gray'); title('Vol Img1Dias Estimé');

subplot(2,5,7);
imagesc(roipoly2_dias); colormap('gray'); title('Vol Img2Dias Estimé');

subplot(2,5,8);
imagesc(roipoly3_dias); colormap('gray'); title('Vol Img3Dias Estimé');

subplot(2,5,9);
imagesc(roipoly4_dias); colormap('gray'); title('Vol Img4Dias Estimé');

subplot(2,5,10);
imagesc(roipoly5_dias); colormap('gray'); title('Vol Img5Dias Estimé');

%% Fracción de eyección estimada
fprintf('Fraccion de eyeccion (estimada) IMG 1: %g\n', sum(roipoly1_sys(:)) - sum(roipoly1_dias(:)));
fprintf('Fraccion de eyeccion (estimada) IMG 2: %g\n', sum(roipoly2_sys(:)) - sum(roipoly2_dias(:)));
fprintf('Fraccion de eyeccion (estimada) IMG 3: %g\n', sum(roipoly3_sys(:)) - sum(roipoly3_dias(:)));
fprintf('Fraccion de eyeccion (estimada) IMG 4: %g\n', sum(roipoly4_sys(:)) - sum(roipoly4_dias(:)));
fprintf('Fraccion de eyeccion (estimada) IMG 5: %g\n', sum(roipoly5_sys(:)) - sum(roipoly5_dias(:)));

